generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  ADMIN
}

enum ProductStatus {
  ACTIVE
  COMPLETED
  FAILED
}

model User {
  id           Int    @id @default(autoincrement())
  profileImage String @default("https://cdn-icons-png.flaticon.com/512/149/149071.png")
  email        String @unique
  password     String
  role         Role   @default(USER)

  firstName String
  lastName  String
  birthDate DateTime?

  wishlist    Product[] @relation("Wishlist")
  joinedSales Product[] @relation("JoinedSales")

  createdAt DateTime @default(now())

  payments Payment[]

  notifications Notification[]
}

model Product {
  id      Int    @id @default(autoincrement())
  name    String
  content String

  regularPrice    Float
  discountedPrice Float

  targetUsersCount Int
  joinedUsers      User[] @relation("JoinedSales")
  wishlistUsers    User[] @relation("Wishlist")

  targetDate DateTime
  supplier   String

  status   ProductStatus @default(ACTIVE)
  category String

  mainImage String
  images    String[]
  videos    String[]

  createdAt DateTime @default(now())

  payments Payment[]
  notificationsLog  Int[]     @default([])
}

enum PaymentStatus {
  PENDING 
  APPROVED 
  PAID 
  FAILED
  REFUNDED
}

model Payment {
  id            Int           @id @default(autoincrement())
  userId        Int
  productId     Int
  paypalOrderId String        @unique
  amount        Float
  currency      String        @default("ILS")
  status        PaymentStatus @default(PENDING)
  authorizationId String?       
  captureId       String?   
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  user          User          @relation(fields: [userId], references: [id])
  product       Product       @relation(fields: [productId], references: [id])

  @@unique([userId, productId])
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int
  title     String
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model Invoice {
  id            Int      @id @default(autoincrement())
  paymentId     Int      @unique
  invoiceNumber String
  provider      String // greeninvoice / icount / וכו
  issuedAt      DateTime @default(now())
}
